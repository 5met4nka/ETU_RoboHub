Чтобы разобраться в чем-то надо сделать это самому! Поэтому сегодня вместе с вами мы создадим своего собственного робота-манипулятора и даже попробуем поуправлять им!

Но как нам придумать способ, с помощью которого мы можем описать манипулятор, ведь у него так много частей - контроллер, сама рука (состоящая из сочленений и приводов), захват? На самом деле очень просто - разработчики приложений в робототехнике уже давно обо всем договорились и придумали единый стандарт описания роботов - формат URDF (расшифровка), с помощью которого можно описать любого робота (по секрету скажу - даже мобильных колесных роботов и даже квадрокоптеры).

Формат описания URDF основан на текстовом языке XML. Основная документация расположена на странице https://wiki.ros.org/urdf/XML.

Давай разберем на примере чтобы было проще. Вот фрагмент описания робота из пакета `fanuc`

```xml
<?xml version="1.0"?>
<robot name="fanuc_lrmate200id7l" xmlns:xacro="http://ros.org/wiki/xacro">

<xacro:include filename="$(find fanuc_resources)/urdf/common_materials.xacro"/>

<link name="base_link">
    <visual>
        <origin xyz="0 0 0" rpy="0 0 0"/>
        <geometry>
            <box size="1 1 1" />
        </geometry>
        <material name="Cyan">
            <color rgba="0 1.0 1.0 1.0"/>
        </material>
    </visual>
    <collision>
        <origin xyz="0 0 0" rpy="0 0 0"/>
        <geometry>
            <cylinder radius="1" length="0.5"/>
        </geometry>
    </collision>
    <inertial>
        <origin xyz="0 0 0.5" rpy="0 0 0"/>
        <mass value="1"/>
        <inertia ixx="100"  ixy="0"  ixz="0" iyy="100" iyz="0" izz="100" />
    </inertial>
</link>

<joint name="joint_1" type="revolute">
    <origin xyz="0 0 0.330" rpy="0 0 0" />
    <parent link="base_link" />
    <child link="link_1" />
    <axis xyz="0 0 1" />
    <limit effort="0" lower="${radians(-170)}" upper="${radians(170)}" velocity="${radians(370)}" />
</joint>

<link name="link_1">
    <visual>
        <origin xyz="0 0 0" rpy="0 0 0"/>
        <geometry>
            <box size="1 1 1" />
        </geometry>
        <material name="Cyan">
            <color rgba="0 1.0 1.0 1.0"/>
        </material>
    </visual>
    <collision>
        <origin xyz="0 0 0" rpy="0 0 0"/>
        <geometry>
            <cylinder radius="1" length="0.5"/>
        </geometry>
    </collision>
    <inertial>
        <origin xyz="0 0 0.5" rpy="0 0 0"/>
        <mass value="1"/>
        <inertia ixx="100"  ixy="0"  ixz="0" iyy="100" iyz="0" izz="100" />
    </inertial>
</link>

```

Начнем разбор с самой первой строчки

```xml
<?xml version="1.0"?>
```

Это так называемый shebang (подробнее можно почитать по ссылке (https://ru.wikipedia.org/wiki/%D0%A8%D0%B5%D0%B1%D0%B0%D0%BD%D0%B3_(Unix))). Это строка, которая позволяет текстовому редактору интерпретировать языки программирования. В нашем случае мы используем язык XML; вспомним первые уроки по OpenCV/Python - в начале редактируемого файла со скриптом нас встречала похожая строка

```python
#!/usr/bin/env python
```

По которой текстовый редактор мог понять, что мы редактируем python-скрипт и включить подсветку синтаксиса.

---

Отлично, начало положено, значит мы сможем разобраться и со всеми тысячами строками файлов URDF (да-да, иногда они бывают огромны, но уверяем вас - вы быстро поймете основные паттерны этого очень удобного инструмента - формата URDF)

Разберем следующий фрагмент

```xml
<!-- ... -->
<robot name="fanuc_lrmate200id7l" xmlns:xacro="http://ros.org/wiki/xacro">
<!-- ... -->
```

Атрибут `robot` является корневым обязательным атрибутом в описании робота. После него идет обязательная строка xmlns:xacro="http://ros.org/wiki/xacro, ссылающая нас к документации (разработчики формата решили позаботиться о нас и любезно оставили ссылку на документации, спасибо им!)

---

Продолжим

```xml
<!-- ... -->
<link name="base_link">
    <visual>
        <origin xyz="0 0 0" rpy="0 0 0"/>
        <geometry>
            <box size="1 1 1" />
        </geometry>
        <material name="Cyan">
            <color rgba="0 1.0 1.0 1.0"/>
        </material>
    </visual>
    <collision>
        <origin xyz="0 0 0" rpy="0 0 0"/>
        <geometry>
            <cylinder radius="1" length="0.5"/>
        </geometry>
    </collision>
    <inertial>
        <origin xyz="0 0 0.5" rpy="0 0 0"/>
        <mass value="1"/>
        <inertia ixx="100"  ixy="0" ixz="0" iyy="100" iyz="0" izz="100" />
    </inertial>
</link>
<!-- ... -->
```

По этому элементу имеется даже отдельная страница документации https://wiki.ros.org/urdf/XML/link, но давайте разберем его здесь.

Элемент 'link' позволяет описать твердое тело с инерцией, визуальными характеристиками и свойствами столновения.

Разберем внутренние элементы

* `<inertial>` (необязательно: по умолчанию нулевая масса и нулевая инерция, если не указано иное)

    Масса звена, положение его центра масс и его центральные инерционные свойства.

    * `<origin>` (необязательно: по умолчанию используется идентификатор, если не указано иное)

        Эта поза (перемещение, вращение) описывает положение и ориентацию центра масс звена системы C относительно звена системы L.

        * `xyz` (необязательно: по умолчанию нулевой вектор)

            Представляет вектор положения от Lo (начало координат системы отсчета) до Co (центр масс системы отсчета) как x L̂x + y L̂y + z L̂z , где L̂x, L̂y, L̂z — ортогональные единичные векторы системы отсчета L.

        * `rpy` (необязательно: по умолчанию используется идентификатор, если не указано иное)

            Представляет ориентацию единичных векторов C Ĉx, Ĉy, Ĉz относительно звена-рамки L как последовательность эйлеровых вращений (rpy) в радианах. Примечание: Ĉx, Ĉy, Ĉz не обязательно должны быть выровнены с главными осями инерции звена.

    * `<mass>`

        Масса ссылки представлена ​​атрибутом value этого элемента.

    * `<inertia>`

        Моменты инерции этой связи ixx, iyy, izz и произведения инерции ixy, ixz, iyz относительно Co (центра масс связи) для единичных векторов Ĉx, Ĉy, Ĉz, зафиксированных в системе центра масс C. Примечание: ориентация Ĉx, Ĉy, Ĉz относительно L̂x, L̂y, L̂z задается значениями rpy в теге <origin>. Атрибуты ixx, ixy, ixz, iyy, iyz, izz для некоторых примитивных форм приведены здесь . URDF предполагает отрицательное произведение соглашения об инерции (для получения дополнительной информации см. эти документы MathWorks по работе с инструментами CAD). Самый простой способ избежать проблем совместимости, связанных с соглашением об отрицательном знаке для произведения инерции, — это выровнять Ĉx, Ĉy, Ĉz с главными направлениями инерции так, чтобы все произведения инерции были равны нулю.

* `<visual>` (необязательно)

    Визуальные свойства ссылки. Этот элемент определяет форму объекта (ящик, цилиндр и т. д.) для целей визуализации. Примечание: для одной ссылки может существовать несколько экземпляров тегов <visual>. Объединение геометрии, которую они определяют, формирует визуальное представление ссылки.

    * `<name>` (необязательно)

        Указывает имя для части геометрии ссылки. Это полезно для возможности ссылаться на определенные биты геометрии ссылки.

    * `<origin>` (необязательно: по умолчанию используется идентификатор, если не указано иное)

        Система отсчета визуального элемента по отношению к системе отсчета ссылки.
        
        * `xyz` (необязательно: по умолчанию нулевой вектор)

            Представляет смещение x , y , z.

        * `rpy` (необязательно: по умолчанию используется идентификатор, если не указано иное)

            Представляет собой углы крена, тангажа и рыскания фиксированной оси в радианах.

    * `<geometry>` (обязательно)

        Форма визуального объекта. Это может быть одно из следующего:

        * `<box>`

            Атрибут size содержит три длины сторон коробки. Начало координат коробки находится в ее центре.

        * `<cylinder>`

            Укажите радиус и длину . Начало координат цилиндра находится в его центр

        * `<sphere>`

            Укажите радиус . Начало координат сферы находится в ее центре.

        * `<mesh>`

            Элемент trimesh, указанный именем файла , и необязательный масштаб , который масштабирует axis-aligned-bounding-box сетки. Любой формат геометрии приемлем, но совместимость с конкретным приложением зависит от реализации. Рекомендуемый формат для лучшей поддержки текстур и цветов — файлы Collada .dae. Файл сетки не передается между машинами, ссылающимися на одну и ту же модель. Это должен быть локальный файл. Добавьте к имени файла префикс package://<packagename>/<path> , чтобы путь к файлу сетки был относительным к пакету <packagename>.

    * `<material>` (необязательно)

        Материал визуального элемента. Разрешается указывать материальный элемент вне объекта 'link', в элементе 'robot' верхнего уровня. Из элемента link можно ссылаться на материал по имени.

        имя название материала

        * `<цвет>` (необязательно)

            rgba Цвет материала, заданный набором из четырех чисел, представляющих красный/зеленый/синий/альфа, каждое из которых находится в диапазоне [0,1].

        * <текстура> (необязательно)

            Текстура материала указывается именем файла.

* `<collision>` (необязательно)

    Свойства коллизий ссылки. Обратите внимание, что это может отличаться от визуальных свойств ссылки, например, более простые модели коллизий часто используются для сокращения времени вычислений. Примечание: для одной ссылки может существовать несколько экземпляров тегов <collision>. Объединение геометрии, которую они определяют, формирует представление коллизий ссылки.

    * `name` (необязательно)

        Указывает имя для части геометрии ссылки. Это полезно для возможности ссылаться на определенные биты геометрии ссылки.

    * `<origin>` (необязательно: по умолчанию используется идентификатор, если не указано иное)

        Система отсчета элемента столкновения относительно системы отсчета звена.

        * `xyz` (необязательно: по умолчанию нулевой вектор)
        Представляет смещение x , y , z.

        * `rpy` (необязательно: по умолчанию используется идентификатор, если не указано иное)

        Представляет собой углы крена, тангажа и рыскания фиксированной оси в радианах.

    * `<геометрия>`

        См. описание геометрии в визуальном элементе выше.

Отлично, давайте разберем 